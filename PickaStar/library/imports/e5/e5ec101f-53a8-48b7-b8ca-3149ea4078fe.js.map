{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["import { Player } from \"./Player\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n    //#region 属性声明\r\n    // 这个属性引用了星星预制资源\r\n    @property(cc.Prefab)\r\n    starPrefab: cc.Prefab = null;\r\n\r\n    // 星星产生后消失时间的随机范围\r\n    @property(cc.Integer)\r\n    maxStarDuration: number = 0;\r\n    @property(cc.Integer)\r\n    minStarDuration: number = 0;\r\n\r\n    // 地面节点，用于确定星星生成的高度\r\n    @property(cc.Node)\r\n    ground: cc.Node = null;\r\n    // player 节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n    @property(cc.Node)\r\n    player: Player = null;\r\n\r\n    // score label 的引用\r\n    @property(cc.Label)\r\n    scoreDisplay: cc.Label = null;\r\n    // 得分音效资源\r\n    @property(cc.AudioClip)\r\n    scoreAudio: cc.AudioClip = null;\r\n\r\n    //#endregion\r\n\r\n    //#region 变量声明\r\n    // 地平面的 y 轴坐标\r\n    groundY = 0;\r\n    // 计时器\r\n    timer = 0;\r\n    // 星星消失的时间\r\n    starDuration = 0;\r\n    // 获得分数\r\n    score = 0;\r\n\r\n    //#endregion\r\n\r\n    onLoad() {\r\n        // 获取地平面的 y 轴坐标\r\n        this.groundY = this.ground.y + this.ground.height / 2;\r\n        // 初始化计时器\r\n        this.timer = 0;\r\n        // 初始化星星消失的时间\r\n        this.starDuration = 0;\r\n        // 生成一个新的星星\r\n        this.spawnNewStar();\r\n        // 初始化计分\r\n        this.score = 0;\r\n    }\r\n\r\n    // 生成一个新的星星\r\n    spawnNewStar() {\r\n        // 使用给定的模板在场景中生成一个新节点\r\n        let newStar = cc.instantiate(this.starPrefab);\r\n        // 将新增的节点添加到 Canvas 节点下面\r\n        this.node.addChild(newStar);\r\n        // 为星星设置一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        // 在星星组件上暂存 Game 对象的引用\r\n        newStar.getComponent(\"Star\").game = this;\r\n        // 重置计时器，根据消失时间范围随机取一个值\r\n        this.timer = 0;\r\n        this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration - this.minStarDuration);\r\n    }\r\n\r\n    // 随机一个星星的位置\r\n    getNewStarPosition(): cc.Vec2 {\r\n        // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\r\n        let randY = this.groundY + (1 - Math.random()) * this.player.getComponent(\"Player\").jumpHeight;\r\n        // 根据屏幕宽度，随机得到一个星星 x 坐标\r\n        let maxX = this.node.width;\r\n        let randX = (Math.random() - 0.5) * maxX;\r\n        return cc.v2(randX, randY);\r\n    }\r\n\r\n    update (dt) {\r\n        // 每帧更新计时器，超过限度还没有生成新的星星\r\n        // 就会调用游戏失败逻辑\r\n        if(this.timer> this.starDuration){\r\n            this.gameOver();\r\n            this.enabled = false;\r\n            return;\r\n        }\r\n        this.timer += dt;\r\n    }\r\n\r\n    gameOver (){\r\n        //停止 player 节点的跳跃动作\r\n        this.player.stopAllActions();\r\n        // 重新加载场景\r\n        cc.director.loadScene(\"game\");\r\n    }\r\n\r\n    gainScore(){\r\n        this.score += 1;\r\n        // 更新 scoreDisplay Label 的文字\r\n        this.scoreDisplay.string = \"Score: \" + this.score;\r\n        // 播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio, false);\r\n    }\r\n}\r\n"]}